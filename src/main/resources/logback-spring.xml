<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!-- Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Spring Boot -->
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>

    <!-- ðŸ–¨ï¸ Appender: ÐšÑ€Ð°ÑÐ¸Ð²Ñ‹Ðµ Ð»Ð¾Ð³Ð¸ Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ (Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸) -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder">
            <pattern>${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}</pattern>
        </encoder>
    </appender>

    <!-- ðŸ“¦ Appender: JSON Ð»Ð¾Ð³Ð¸ Ð´Ð»Ñ Loki (Promtail) -->
    <appender name="JSON_FILE" class="ch.qos.logback.core.FileAppender">
        <file>/app/logs/app.log</file>
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <providers>
                <timestamp/>
                <message/>
                <loggerName/>
                <level/>
                <threadName/>
                <mdc/>
                <stackTrace/>
            </providers>
        </encoder>
    </appender>

    <!-- ðŸ“ Appender: JSON Ð² stdout (Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð° Ñ„Ð°Ð¹Ð»Ñƒ, ÐµÑÐ»Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ð² Docker) -->
    <!-- Ð Ð°ÑÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹, ÐµÑÐ»Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ JSON Ð² stdout -->
    <!--
    <appender name="JSON_CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
            <providers>
                <timestamp/>
                <message/>
                <loggerName/>
                <level/>
                <threadName/>
                <mdc/>
                <stackTrace/>
            </providers>
        </encoder>
    </appender>
    -->

    <!-- ðŸ§© ÐšÐ¾Ñ€Ð½ÐµÐ²Ð¾Ð¹ Ð»Ð¾Ð³Ð³ÐµÑ€ -->
    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
        <!-- Ð’Ñ‹Ð±ÐµÑ€Ð¸ ÐžÐ”Ð˜Ð Ð¸Ð· Ð´Ð²ÑƒÑ… Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð² Ð½Ð¸Ð¶Ðµ -->

        <!-- Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ A: JSON Ð² Ñ„Ð°Ð¹Ð» (Ð»ÑƒÑ‡ÑˆÐµ Ð´Ð»Ñ Docker + Promtail) -->
        <appender-ref ref="JSON_FILE"/>

        <!-- Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ B: JSON Ð² stdout (ÐµÑÐ»Ð¸ Ð½Ðµ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ Ñ„Ð°Ð¹Ð») -->
        <!-- <appender-ref ref="JSON_CONSOLE"/> -->
    </root>
</configuration>